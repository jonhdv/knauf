{% extends "users/layout.html.twig" %}

{% set curPage = 'date' %}

{% block stylesheets %}
    {{ parent() }}

    <link rel="stylesheet" href="{{ asset('assets/css/training.css') }}" />
{% endblock %}

{% block body %}
    <div class="text-center main-title mx-auto mx-3 pt-3">
        <h3 class="text-center mt-4 mb-3">SELECCIONA FECHA Y HORA</h3>
    </div>

    <div class="col-md-12 col-md-offset-2 d-flex justify-content-center my-5">
        <input type="datetime-local" class="training-date">
    </div>

    <div class="col-12 d-flex justify-content-center my-5">
        <input class="block-send" type="submit" value="SIGUIENTE">
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>
        let totalTime = 0;

        (function($) {
            'use strict';

            //Acción cuando se pulsa para enviar los resultados
            $('.block-send').click(function (event) {
                if (totalTime < 40) {
                    event.preventDefault();
                    alert('¡No has alcanzado el tiempo mínimo de 40 minutos!');
                }
            });

            //Acción cada vez que se pulsa el block-checker
            $('.block-checker input[type=checkbox]').change(function() {
                console.log('funciona');
                changetime($(this).data('value-time'), $(this).prop('checked'), $(this));
            });

            function changetime(time, checked, checkbox) {
                if (checked) {
                    totalTime = totalTime + time;
                } else {
                    totalTime = totalTime - time;
                }

                if (totalTime > 120) {
                    alert('Has superado el límite de 120 minutos');
                    totalTime = totalTime - time;
                    checkbox.prop('checked', false);
                    return;
                }

                $('.time-bar-progress').css('width', (totalTime / 120 * 100) + '%');

                let $timeBarProgressLabel = $('.time-bar-progress label');

                if (totalTime > 0) {
                    $timeBarProgressLabel.show();
                    $timeBarProgressLabel.text(totalTime + "'");
                } else {
                    $timeBarProgressLabel.hide();
                }
            }
        })(jQuery);
    </script>
{% endblock %}