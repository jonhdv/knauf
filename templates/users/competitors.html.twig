{% extends "users/layout.html.twig" %}

{% set curPage = 'competitors' %}

{% block stylesheets %}
    {{ parent() }}

    <link rel="stylesheet" href="{{ asset('assets/css/training.css') }}" />
{% endblock %}

{% block body %}
    <div class="text-center main-title mx-auto mx-3 pt-3">
        <h3 class="text-center mt-4 mb-">AÑADE PARTICIPANTES AL CURSO</h3>
    </div>

    <div class="d-flex mt-4">
        <table class="table table-responsive competitors-list mx-auto">
            <tr>
                <th></th>
                <th>Nombre</th>
                <th>Apellido</th>
                <th>Email</th>
                <th>Puesto</th>
                <th>Intolerancias</th>
                <th>Acciones</th>
            </tr>

            {% for competitor in competitors %}
                <tr>
                    <td><input type="checkbox"></td>
                    <td>{{ competitor.name }}</td>
                    <td>{{ competitor.surname }}</td>
                    <td>{{ competitor.email }}</td>
                    <td>{{ competitor.position }}</td>
                    <td>{{ competitor.foodIntolerances }}</td>
                    <td>
                        <a href="#">Editar</a>
                        <a href="#" class="text-danger">Borrar</a>
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>
        let totalTime = 0;

        (function($) {
            'use strict';

            //Acción cuando se pulsa para enviar los resultados
            $('.block-send').click(function (event) {
                if (totalTime < 40) {
                    event.preventDefault();
                    alert('¡No has alcanzado el tiempo mínimo de 40 minutos!');
                }
            });

            //Acción cada vez que se pulsa el block-checker
            $('.block-checker input[type=checkbox]').change(function() {
                console.log('funciona');
                changetime($(this).data('value-time'), $(this).prop('checked'), $(this));
            });

            function changetime(time, checked, checkbox) {
                if (checked) {
                    totalTime = totalTime + time;
                } else {
                    totalTime = totalTime - time;
                }

                if (totalTime > 120) {
                    alert('Has superado el límite de 120 minutos');
                    totalTime = totalTime - time;
                    checkbox.prop('checked', false);
                    return;
                }

                $('.time-bar-progress').css('width', (totalTime / 120 * 100) + '%');

                let $timeBarProgressLabel = $('.time-bar-progress label');

                if (totalTime > 0) {
                    $timeBarProgressLabel.show();
                    $timeBarProgressLabel.text(totalTime + "'");
                } else {
                    $timeBarProgressLabel.hide();
                }
            }
        })(jQuery);
    </script>
{% endblock %}