{% extends "users/layout.html.twig" %}

{% set curPage = 'blocks' %}

{% block stylesheets %}
    {{ parent() }}

    <link rel="stylesheet" href="{{ asset('assets/css/training.css') }}" />
{% endblock %}

{% block body %}
    <div class="px-3 mt-5">
        <div class="text-center main-title mx-auto mx-3 pt-3">
            <h3>AHORA ELIGE LOS MÓDULOS QUE MEJOR SE ADAPTEN A TUS PROYECTOS</h3>
        </div>

        <div class="time-bar mx-auto mt-5 mx-3">
            <label>120'</label>

            <div class="time-bar-fixed">
                <label>45'</label>
            </div>

            <div class="time-bar-progress">
                <label></label>
            </div>
        </div>

        <div class="text-center main-info mx-auto mt-5">
            45 minutos (tiempo mínimo de formación)<br>
            120 minutos (tiempo máximo de formación)
        </div>
    </div>

    <form class="row mx-auto justify-content-center mt-5" action="checkBlocks.php">
        {% for key, block in blocks %}
            {% if key == 0 or key == 7 or key == 14 %}
                <div class="block-column {{ key == 7 ? 'grey' : 'white' }} col-12 col-lg-4 px-0">
            {% endif %}

                <div class="block-container d-flex align-items-center">
                    <label class="block-checker">
                        <input type="checkbox" name="block[{{ block.id }}]" data-value-time="{{ block.time }}" autocomplete='off'>
                        <span class="checkmark"></span>
                    </label>

                    <div class="block-image">
                        <img src="{{ asset('assets/img/bloque' ~ block.id ~ 't.svg') }}">
                    </div>
                </div>

            {% if key == 6 or key == 13 or key == 20 %}
                </div>
            {% endif %}
        {% endfor %}

            <div class="col-12 d-flex justify-content-center my-5">
                <a class="btn btnsexto block-send" href="{{ path('users_training_date') }}">Siguiente</a>
            </div>
        </form>
    </main>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>
        let totalTime = 0;

        (function($) {
            'use strict';

            //Acción cuando se pulsa para enviar los resultados
            $('.block-send').click(function (event) {
                if (totalTime < 40) {
                    event.preventDefault();
                    alert('¡No has alcanzado el tiempo mínimo de 40 minutos!');
                    return;
                }
            });

            //Acción cada vez que se pulsa el block-checker
            $('.block-checker input[type=checkbox]').change(function() {
                console.log('funciona');
                changetime($(this).data('value-time'), $(this).prop('checked'), $(this));
            });

            function changetime(time, checked, checkbox) {
                if (checked) {
                    totalTime = totalTime + time;
                } else {
                    totalTime = totalTime - time;
                }

                if (totalTime > 120) {
                    alert('Has superado el límite de 120 minutos');
                    totalTime = totalTime - time;
                    checkbox.prop('checked', false);
                    return;
                }

                $('.time-bar-progress').css('width', (totalTime / 120 * 100) + '%');

                let $timeBarProgressLabel = $('.time-bar-progress label');

                if (totalTime > 0) {
                    $timeBarProgressLabel.show();
                    $timeBarProgressLabel.text(totalTime + "'");
                } else {
                    $timeBarProgressLabel.hide();
                }
            }
        })(jQuery);
    </script>
{% endblock %}